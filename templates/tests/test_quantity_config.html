<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Configuration des quantit√©s d'unit√©s</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .unit-info {
            display: inline-block;
            padding: 10px;
            margin: 5px;
            border: 2px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
        }
        .unit-info.base-unit {
            border-color: #4CAF50;
            background: #e8f5e8;
        }
        .unit-info.shop-unit {
            border-color: #2196F3;
            background: #e3f2fd;
        }
        .unit-info.highlight {
            border-color: #FF9800;
            background: #fff3e0;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: #2196F3;
            color: white;
        }
        button:hover {
            background: #1976D2;
        }
        .log {
            background: #f0f0f0;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-family: monospace;
            max-height: 200px;
            overflow-y: auto;
        }
        .config-panel {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .config-panel input {
            width: 60px;
            margin: 0 5px;
        }
        .stats-panel {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Test - Configuration des quantit√©s d'unit√©s</h1>
    
    <div class="test-section">
        <h2>Configuration des quantit√©s</h2>
        <p>Modifiez les quantit√©s des unit√©s de base pour tester la nouvelle structure simplifi√©e :</p>
        
        <div class="config-panel">
            <h3>Quantit√©s actuelles :</h3>
            <div id="quantity-config"></div>
            <button onclick="applyQuantities()">Appliquer les nouvelles quantit√©s</button>
        </div>
        
        <button onclick="testDrawCombatTroops()">Test - Tirer des troupes de combat</button>
        <button onclick="testShowAllTroops()">Test - Afficher toutes les troupes</button>
        <button onclick="testShopUnits()">Test - Unit√©s du magasin</button>
        <button onclick="resetTest()">R√©initialiser</button>
        
        <h3>R√©sultats des tests :</h3>
        <div id="log" class="log"></div>
    </div>

    <div class="test-section">
        <h2>Unit√©s configur√©es</h2>
        <div class="stats-panel">
            <h3>Unit√©s de base (quantity > 0) :</h3>
            <div id="base-units-display"></div>
        </div>
        <div class="stats-panel">
            <h3>Unit√©s du magasin (quantity = 0) :</h3>
            <div id="shop-units-display"></div>
        </div>
    </div>

    <script type="module">
        import { GameState } from '../js/modules/GameState.js';
        import { BASE_UNITS } from '../js/modules/UnitConstants.js';

        let gameState;
        let originalQuantities = {};

        // Initialiser le jeu
        function initGame() {
            gameState = new GameState();
            
            // Sauvegarder les quantit√©s originales
            BASE_UNITS.forEach(unit => {
                originalQuantities[unit.name] = unit.quantity || 5;
            });
            
            log('Jeu initialis√©');
            updateQuantityConfig();
            updateUnitsDisplay();
        }

        // Mettre √† jour l'affichage de la configuration
        function updateQuantityConfig() {
            const container = document.getElementById('quantity-config');
            container.innerHTML = '';
            
            BASE_UNITS.forEach(unit => {
                const div = document.createElement('div');
                div.innerHTML = `
                    <label>${unit.icon} ${unit.name}: </label>
                    <input type="number" min="0" max="20" value="${unit.quantity || 5}" 
                           id="quantity-${unit.name.replace(/\s+/g, '-')}">
                    <span>(d√©faut: ${originalQuantities[unit.name]})</span>
                    <span style="color: ${unit.quantity === 0 ? '#2196F3' : '#4CAF50'}; font-weight: bold;">
                        ${unit.quantity === 0 ? 'Magasin' : 'Base'}
                    </span>
                `;
                container.appendChild(div);
            });
        }

        // Appliquer les nouvelles quantit√©s
        function applyQuantities() {
            BASE_UNITS.forEach(unit => {
                const inputId = `quantity-${unit.name.replace(/\s+/g, '-')}`;
                const input = document.getElementById(inputId);
                if (input) {
                    const newQuantity = parseInt(input.value) || 5;
                    unit.quantity = newQuantity;
                    log(`‚úÖ ${unit.name}: quantit√© mise √† jour √† ${newQuantity} (${newQuantity === 0 ? 'Magasin' : 'Base'})`);
                }
            });
            
            // R√©initialiser le jeu pour appliquer les changements
            gameState = new GameState();
            log('üîÑ Jeu r√©initialis√© avec les nouvelles quantit√©s');
            updateUnitsDisplay();
        }

        // Test - Tirer des troupes de combat
        function testDrawCombatTroops() {
            if (!gameState) {
                log('‚ùå Jeu non initialis√©');
                return;
            }
            
            log('=== Test - Tirer des troupes de combat ===');
            
            // Compter les troupes par type avant
            const beforeCounts = {};
            gameState.combatTroops.forEach(troop => {
                beforeCounts[troop.name] = (beforeCounts[troop.name] || 0) + 1;
            });
            
            log(`üìä Troupes de combat avant: ${gameState.combatTroops.length}`);
            Object.keys(beforeCounts).forEach(name => {
                log(`  - ${name}: ${beforeCounts[name]}`);
            });
            
            // Tirer de nouvelles troupes
            gameState.drawCombatTroops();
            
            // Compter les troupes par type apr√®s
            const afterCounts = {};
            gameState.combatTroops.forEach(troop => {
                afterCounts[troop.name] = (afterCounts[troop.name] || 0) + 1;
            });
            
            log(`üìä Troupes de combat apr√®s: ${gameState.combatTroops.length}`);
            Object.keys(afterCounts).forEach(name => {
                log(`  - ${name}: ${afterCounts[name]}`);
            });
            
            log('‚úÖ Test termin√©');
        }

        // Test - Afficher toutes les troupes
        function testShowAllTroops() {
            if (!gameState) {
                log('‚ùå Jeu non initialis√©');
                return;
            }
            
            log('=== Test - Afficher toutes les troupes ===');
            
            // Simuler l'affichage de toutes les troupes
            const fullTroopPool = [];
            gameState.getBaseUnits().forEach(unit => {
                const quantity = unit.quantity || 5;
                log(`üì¶ G√©n√©ration de ${quantity} ${unit.name}`);
                for (let i = 0; i < quantity; i++) {
                    fullTroopPool.push({...unit, id: `${unit.name}_${i}`});
                }
            });
            
            // Grouper par nom
            const troopsByType = {};
            fullTroopPool.forEach(troop => {
                if (!troopsByType[troop.name]) {
                    troopsByType[troop.name] = 0;
                }
                troopsByType[troop.name]++;
            });
            
            log('üìä R√©sum√© des troupes g√©n√©r√©es:');
            Object.keys(troopsByType).forEach(name => {
                const unit = gameState.getBaseUnits().find(u => u.name === name);
                const expectedQuantity = unit ? (unit.quantity || 5) : 0;
                const actualQuantity = troopsByType[name];
                const status = actualQuantity === expectedQuantity ? '‚úÖ' : '‚ùå';
                log(`  ${status} ${name}: ${actualQuantity}/${expectedQuantity}`);
            });
            
            log('‚úÖ Test termin√©');
        }

        // Test - Unit√©s du magasin
        function testShopUnits() {
            if (!gameState) {
                log('‚ùå Jeu non initialis√©');
                return;
            }
            
            log('=== Test - Unit√©s du magasin ===');
            
            const shopUnits = gameState.getShopUnits();
            log(`üìä Unit√©s disponibles dans le magasin: ${shopUnits.length}`);
            
            shopUnits.forEach(unit => {
                log(`  üõí ${unit.icon} ${unit.name} (${unit.rarity}) - ${unit.damage} dmg √ó${unit.multiplier}`);
            });
            
            const baseUnits = gameState.getBaseUnits();
            log(`üìä Unit√©s de base: ${baseUnits.length}`);
            
            baseUnits.forEach(unit => {
                log(`  üè† ${unit.icon} ${unit.name} (${unit.rarity}) - Quantit√©: ${unit.quantity}`);
            });
            
            log('‚úÖ Test termin√©');
        }

        // R√©initialiser le test
        function resetTest() {
            // Restaurer les quantit√©s originales
            BASE_UNITS.forEach(unit => {
                unit.quantity = originalQuantities[unit.name];
            });
            
            gameState = new GameState();
            log('üîÑ Test r√©initialis√© avec les quantit√©s originales');
            updateQuantityConfig();
            updateUnitsDisplay();
        }

        // Mettre √† jour l'affichage des unit√©s
        function updateUnitsDisplay() {
            const baseContainer = document.getElementById('base-units-display');
            const shopContainer = document.getElementById('shop-units-display');
            
            baseContainer.innerHTML = '';
            shopContainer.innerHTML = '';
            
            BASE_UNITS.forEach(unit => {
                const div = document.createElement('div');
                div.className = `unit-info ${unit.quantity > 0 ? 'base-unit' : 'shop-unit'}`;
                div.innerHTML = `
                    <div><strong>${unit.icon} ${unit.name}</strong></div>
                    <div>üí• ${unit.damage} ‚ö° ${unit.multiplier}</div>
                    <div>Type: ${Array.isArray(unit.type) ? unit.type.join(', ') : unit.type}</div>
                    <div>Quantit√©: <strong>${unit.quantity || 5}</strong></div>
                    <div>Raret√©: ${unit.rarity}</div>
                `;
                
                if (unit.quantity > 0) {
                    baseContainer.appendChild(div);
                } else {
                    shopContainer.appendChild(div);
                }
            });
        }

        // Logger les messages
        function log(message) {
            const logContainer = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            logContainer.innerHTML += `[${timestamp}] ${message}\n`;
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // Exposer les fonctions globalement
        window.applyQuantities = applyQuantities;
        window.testDrawCombatTroops = testDrawCombatTroops;
        window.testShowAllTroops = testShowAllTroops;
        window.testShopUnits = testShopUnits;
        window.resetTest = resetTest;

        // Initialiser au chargement
        initGame();
    </script>
</body>
</html> 